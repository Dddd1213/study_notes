# 计组

[TOC]

# 1.1

## 硬件的发展

- 逻辑元件
  - 电子管
  - 晶体管
  - 中小规模集成电路
  - 大规模、超大集成电路

# 1.2

## 计算机硬件基本组成

### 冯诺依曼

- 存储程序

  ![image-20230830214904470](http://123.249.77.122/wp-content/uploads/2023/09/0bfabbbdb25bb7168e2ce473a8b633f.png)

- 特点

  - 计算机由五大部件组成
  - 指令和数据以同等地位存于存储器，可按地址寻访
  - 指令和数据用二进制表示
  -  指令由操作码和地址码组成
  -  存储程序
  - **以运算器为中心** 数据传输需要用运算器中转

- 现代：以存储器为中心

  ![image-20230830215651376](http://123.249.77.122/wp-content/uploads/2023/09/2b72b2829850735d176d92f715124e6.png)

  

### 主存储器

- 存储体
  - 存储单元：MAR位数反应存储单元的个数
  - 存储字（word）
  - 存储字长：MDR位数 = 存储字长
  - 存储元
- MAR 地址寄存器
- MDR 数据寄存器

### 运算器

- ![image-20230830221146844](http://123.249.77.122/wp-content/uploads/2023/09/912254460b33a87b75a18a8866f991f.png)



### 控制器

- CU 控制单元，分析，给出控制信号
- IR 指令寄存器，执行 
- PC 程序计数器，存放下一条指令地址

### 工作过程

![image-20230830231339360](http://123.249.77.122/wp-content/uploads/2023/09/d8591b8942a4830ead1c1032705711f.png)

## 计算机的层次结构

- 五层结构
- 三个级别的语言：高级语言 汇编语言 机器语言

# 1.3

## 性能指标

### 存储器

- MAR：位数反应存储单元的个数（2^n），**最多**支持多少个
- MDR：MDR位数 = 存储字长 = 每个存储单元的大小
- 总容量 = 存储单元个数 * 存储字长 bit
- 单位：2^10 k ,  2^20 M , 2^30 G , 2^40 T

## CPU

- CPU主频：CPU内数字脉冲信号震荡的频率
- CPU主频 = 1/CPU时钟周期，单位Hz
- CPI：每一条指令的执行需要多少个时钟周期数
- 执行一条指令的耗时（CPU执行时间） = CPI * CPU时钟周期
- IPS：每秒执行多少条指令 = 主频/平均CPI
- FLOPS：每秒执行多少次浮点运算
- 单位： 1e3 k, 1e6 M, 1e9 G, 1e20 T

### 系统整体性能指标

- 数据通路带宽：数据总线一次能并行传送信息的位数
- 吞吐量：系统单位时间内处理请求的数量
- 响应时间
- 基准程序



# 2.1

## 进位计数制

- 基数：不同符号的个数
- 十进制转任意进制：除基取余，由低到高；乘基取整，由高到低



## BCD码

- 4个二进制表示一位十进制
  - 8421码：加法若不在区间则+6
  - 余3码：8421码+3
  - 2421码

## 无符号整数

- 减法运算：被减数不变，减数**全部按位取反，末位+1，减法变加法**

## 带符号整数 原反补

### 转换规则

- **正数**：原码 <->反码 <-> 补码
- **负数**：原码 <-> （**符号位不变，数值位取反**）反码 -> （末位+1）补码
- 负数补码  <-> （**从右往左**找到第一个1，这个1左边所有“数值位”按位取反）原码
- 补码加法：**符号位也参与运算**，并进位
- A的补码 <->（**从右往左**找到第一个1，这个1左边所有位按位取反）-A 的补码

### 特性对比

![257e9845bb041b3f5c4ff4a0787eb19](http://123.249.77.122/wp-content/uploads/2023/09/257e9845bb041b3f5c4ff4a0787eb19.png)

### 移码

- 补码基础上将**符号位取反**
- 只能表示整数

### 定点小数

- 原码：小数点隐藏在符号位的后面

# 2.2

## 算数逻辑单元

### 算术逻辑单元 ALU

### 基本的逻辑运算

- 与或非，与 > 或

  ![image-20230903224949277](http://123.249.77.122/wp-content/uploads/2023/09/aee2add1177244ae1873000aaea5b0c.png)

- ![image-20230903225201806](http://123.249.77.122/wp-content/uploads/2023/09/1fdf8d5734611a99ddfc8b511a8ac4b.png)

- 同或：异或取反
- 基数校验/偶数校验：异或

### 一位全加器

![cacd959fb86a17beefb0cb4e37c8e66](http://123.249.77.122/wp-content/uploads/2023/09/cacd959fb86a17beefb0cb4e37c8e66.png)

- 串行/并行加法器

### 补码加减运算器

![image-20230904003420176](http://123.249.77.122/wp-content/uploads/2023/09/68399db6f9e5ab50858c9d91534ff8b.png)

- 注意溢出问题


### 判断溢出

![image-20230904003420176](http://123.249.77.122/wp-content/uploads/2023/09/4dcc6bd48ab017d0a9ac7d57084a7b1.png)

![image-20230904011720673](http://123.249.77.122/wp-content/uploads/2023/09/d42f24c47c49bc30d645cdd8e8336e8.png)

- 方法三（常考）：双符号位，S1异或S2


### 符号扩展

## 标志位的生成

- OF Overflow Flag 是否溢出
- SF Sign Flag
- ZF Zero Flag
- CF Carry Flag
- ALU每进行一次运算，标志位都会自动存入PSW程序状态寄存器

![image-20230904012606351](http://123.249.77.122/wp-content/uploads/2023/09/3a58a2ef7a1a409479ba99a0a2c975d.png)

## 算数移位

### 原码

- 右移：高位补0，低位舍弃
- 左移：低位补0，高位舍弃

### 反码

- 正数
- 负数：补1

### 补码

- 正数
- 负数：最右边的1及其右边同原码，左边同补码

## 乘法

### 原码一位乘法

- 和十进制竖式相同

- +0或+[|x|]原

- 每加一次 ACC和MQ都右移一位，以实现错位相加

- 符号位不参与运算

  ![image-20230905154052564](http://123.249.77.122/wp-content/uploads/2023/09/58ae6ec224de6868321555d74db2386.png)

![image-20230905154418650](http://123.249.77.122/wp-content/uploads/2023/09/0501c9c10e095f231c00aae72fe3957.png)



### 补码一位乘法

- 符号位参与运算
- 辅助位 双符号位（乘数是单符号位）
- ![image-20230905155029668](http://123.249.77.122/wp-content/uploads/2023/09/83355db645f9ed955b0a34c478dbe51.png)



### 原码：恢复余数法 加减交替法

- 每算一位，ACC和MQ逻辑左移
- ![image-20230905173742971](http://123.249.77.122/wp-content/uploads/2023/09/404a629acb0a5db23e70e34637b21dd.png)

hsw到此一游 球球 勿删 复习时的小乐趣

- **加减交替法**：若余数减完除数为负，余数左移1位 + 除数



### 补码：加减交替法

- 双符号位
- 符号参与运算
- 被除数和除数同号：被除数减除数；异号：加；
- **余数和除数同号：商1，余数左移一位减除数；异号：商0，余数左移一位加除数。**
- **最后一位商恒置为1**



## C语言类型转换

- C语言中定点整数是用“补码”存储的



## 数据的存储和排列

- 大小端方式 
  - 大端（便于人类阅读）：低地址部分存储MSB最高有效字节
  - 小端（便于机器处理）：低地址部分存储LSB最低有效字节
- 边界对齐：空间换时间



# 2.3

## 浮点数

### 表示

- 阶码：**补码/移码**表示的定点**整数**，大小；底通常为2, 2^i；
- 尾数：**原码/补码**表示的定点**小数**，精度；

### 规格化

- 右规：小数点在第一位非0的数值后
- 左规：小数点后第一位必须是有效值（非0）

- 原码：尾数的最高数值位必须是1
- 补码：尾数的最高数值位必须和符号位相反



### 标准 IEEE

- 移码：补码符号位取反
- 移码 = 真值 + 偏置值

- **记住！**![image-20230911113540698](http://123.249.77.122/wp-content/uploads/2023/09/d8d5e1d662430c8188a4ff30583adce.png)



- ![image-20230911115540902](http://123.249.77.122/wp-content/uploads/2023/09/4f11f7f98460cbddfc9f1783fc56988.png)
- ![image-20230911113540698](http://123.249.77.122/wp-content/uploads/2023/09/f124247fb222d389538f78bd11f1938.png)

#### 非规格化小数

- 阶码全0，尾数不全为0 - > 认为小数点前面那位是0，阶码真值为**-126**
- 阶码全0，尾数全0 -> +-0
- 阶码全1，尾数全0 -> 无穷大
- 阶码全1，尾数不全为0 -> 非数值

### 浮点数的计算

![image-20230911115540902](http://123.249.77.122/wp-content/uploads/2023/09/4bfd4c58d7b486081293cae8589fa89.png)

![image-20230911210222691](http://123.249.77.122/wp-content/uploads/2023/09/0e4f306f32433efd103aecf93e94fef.png)



### 强制类型转换

![image-20230911210810690](http://123.249.77.122/wp-content/uploads/2023/09/826bcf521226de90d5e63287262cf18.png)

# 3.1 

## 存储系统

### 层次结构

![image-20230914090445450](http://123.249.77.122/wp-content/uploads/2023/09/d60076f5249e07d2be58967f000b694.png)

### 分类

- 存储介质：半导体、磁性材料、光介质
- 存取方式：随机存取，顺序存储，直接存取
- 可更改性
- 可保存性

### 性能指标

- 存储容量 = 存储字数 * 字长
- 单位成本：每位价格 = 总成本/总容量
- 存储速度：**数据传输率** = 数据的宽度/存储周期
  - 数据传输率又叫主存带宽
  - 存取时间 + 恢复时间 = 存取周期

# 3.2

## 主存储器的基本组成

- 存储体，MAR，MDR
- ![image-20230914093755411](http://123.249.77.122/wp-content/uploads/2023/09/e1be5b093401d23819bd4b4cb913ff0.png)

- 金属引脚 = 地址线（sqrt（a）） + 数据线（b） + 片选线（一根） + 读/写控制线（一般是各一根）；
- a*b位的存储芯片：a表示存储单元的数量，b表示存储字长

## DRAM和SRAM  

### DRAM

- Dynamic 动态
- 用于主存（现在用SDRAM）
- 栅极电容（上一节的存储元）：有无电流
- 破坏性读出，读出后还要重写 读取更慢
- 成本低，集成度高

#### 刷新

- 电容存储的电荷可能流失 -> 2ms刷新（给电容充电）

- 每次刷新一行存储单元

- 由存储器完成，不需要CPU控制

- 行列地址：减少选通线的数量

  ![image-20230914201751703](http://123.249.77.122/wp-content/uploads/2023/09/124d16e937858930d22d2f2b5dd7ddb.png)

- 分散刷新：每次读写完都刷新一行

- 集中刷新：2ms内集中安排时间全部刷新 死区

- 异步刷新：/可在译码阶段刷新

  ![image-20230914202026230](http://123.249.77.122/wp-content/uploads/2023/09/01d698da28bca1b2dda9c91a4b874f7.png)

#### 地址线复用技术

- 行列地址分两次送，地址引脚减半

### SRAM

- static 静态
- 用于Cache
- 双稳定触发器：BL还是BLX输出低电平 - > 区分01
- 非破坏性读出 **读取更快**
- **成本高，集成度低**

![image-20230914193741745](http://123.249.77.122/wp-content/uploads/2023/09/38941fc8c912b94d436ba5d07db2e89.png)

### 对比

![image-20230914201406032](http://123.249.77.122/wp-content/uploads/2023/09/33ec2013b2aa6ec2bea2e46700f33ea.png)



## ROM芯片

- ram芯片：支持随机存取，读取速度很快；易失性，断电后数据消失
- rom：非易失性

### 常见类型

- **MROM 掩模式只读存储器**：只读不写
- **PROM**：写一次之后就不可更改
- **EPROM**：可擦除进行多次重写，每次都需要擦除所有信息
- **EEPROM**：“电擦除”，可以擦除特定字
- **Flash** **Memory  闪存** （U盘，SD卡）：多次快速擦除重写，写比读慢；每个存储元只需要单个MOS管，位密度高
- **SSD 固态硬盘**：控制单元 + 存储单元（Flash芯片），和上面核心区别在控制单元不一样

### 计算机

- BIOS芯片（ROM）：自举装入程序（开机装操作系统）
- 和主存RAM统一编址



## 双端口RAM和多模块存储器

### 双端口RAM

- 有两组完全独立的数据线、地址线....
- 可以同时读，但写写、读写冲突
- 设置信号暂时关闭另一个端口

### 多体并行存储器

- （高位交叉编址和低位交叉编址）
- 每个模块都有独立的读写控制电路....

![image-20230914205918399](http://123.249.77.122/wp-content/uploads/2023/09/e12cde36215bd9fdce4cead2122d6fc.png)

![image-20230914210213666](http://123.249.77.122/wp-content/uploads/2023/09/50a106d7d1935024fbb8c62f642db28.png)

- 存取周期T，存取时间（或总线传输周期）为r，令T = 4r，应保证模块数 m >= T/r，以达到“流水线”

### 单体多字存储器

- “一套”
- 一次读取一行m个字
- 灵活性更差



# 3.3

## 主存储器与CPU的连接

- 现在的计算机

![image-20230914214443405](http://123.249.77.122/wp-content/uploads/2023/09/9c1fe7d0abcd34aaf1395660700e1c5.png)

### 位扩展

- 位扩展是指增加存储字长，例如，2片1K X4位的芯片，可以组成1K X 8位的存储器。满足下列条件时，采用位扩展的方式：
  - 只加长每个存储单元的字长，而不增加存储单元的数量
  - 芯片数=设计要求的存储器容量/选择芯片存储器容量
  - 芯片之间采用**并联**的方式

![image-20230914214443405](http://123.249.77.122/wp-content/uploads/2023/09/dbfc0cbeeb7b95bb0420ba9f26804c1.png)

### 字扩展

- 线选法：n条线n个选片信号，用地址线作片选信号（用A13和A14来控制CS片选线），地址空间不连续

- 译码片选法：n条线2^n个片选信号，地址空间连续

- 注意：**地址**译码器不在CPU中

- 串联

- 译码器：12译码器，38译码器....

  - “使能端”：连接CPU的MREQ，控制片选信号的生效时间

  ![image-20230914220724409](http://123.249.77.122/wp-content/uploads/2023/09/9d9a0300badb1c9ff1394f9cd19c4bb.png)

![image-20230914222533688](http://123.249.77.122/wp-content/uploads/2023/09/2063d14d53599bbfd7e1630471379b8.png)

- 74LS138：3个“使能”，3个输入端，8个输出端

# 3.4

## 磁盘存储器

### 外存储器

#### 磁表面存储器

- 1bit为单位；读写不能同时进行

- 优点：①存储容量大，位价格低；②记录介质可以重复使用；③记录信息可以长期保存而不丢失，甚至可以脱机存档；④非破坏性读出,读出时不需要再生
- 缺点：①存取速度慢；②机械结构复杂；③对工作环境要求较高

#### 磁盘存储器

![image-20230914230243050](http://123.249.77.122/wp-content/uploads/2023/09/ddc3db9e880db53e7dbdd5b32c1ee48.png)

### 性能指标

![image-20230914235822721](http://123.249.77.122/wp-content/uploads/2023/09/636741bd65d0736246a9331d9a901b6.png)

- **平均存取时间** = 寻道时间(磁头移动到目的磁道) 

  + 旋转延迟时间(磁头定位到所在扇区) （默认为转半圈的时间）

  +传输时间（传输数据所花费的时间）

- 数据传输率：磁盘存储器在**单位时间**内向主机传送数据的字节数，称为数据传输率。假设磁盘转数为r (转/秒) ,每条磁道容量为N个字节,则数据传输率为 r*N

### 磁盘工作原理

- 磁盘地址：驱动器号、柱面（磁道）号、盘面号、扇区号
- 读写操作串行，并串变换电路

### 磁盘阵列

- RAID 廉价冗余磁盘阵列：将多个独立的物理磁盘组成一个独立的逻辑盘,数据在多个物理盘上分割交叉存储、并行访问

- 具有更好的存储性能（类似低位交叉编址）

- 可靠性和安全性（用一定空间存镜像、校验码）

  - RAID0：仅提高存取速度，没有容错能力
  - RAID1：镜像阵列，容量减少一半
  - RAID2~5：海明码、奇偶校验....

  [计算机组成原理：奇偶校验和汉明码校验_汉明校验码_小许要加油啊～的博客-CSDN博客](https://blog.csdn.net/weixin_56937141/article/details/124383543?ops_request_misc=%7B%22request%5Fid%22%3A%22169537135516800222814770%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=169537135516800222814770&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-124383543-null-null.142^v94^chatsearchT3_1&utm_term=按奇偶校验配置的汉明码纠错过程&spm=1018.2226.3001.4187)

## 固态硬盘 SSD

![image-20230915161646591](http://123.249.77.122/wp-content/uploads/2023/09/2501aa17dbe0687d84338fa2c3129c5.png  )

# 3.5（重点）

## Cache

- 集成在CPU内部

- 局部性原理
- 命中率/缺失率 平均访问时间

- 以“块”为单位交换

## 映射方式

- 有效位+标记

### 全相联映射

- 任意

### 直接映射

- cache块号 = 主存块号%cache总块数
- 灵活性差，空间利用率差
- 访问速度最快；

### 组相联映射

- cache块号 = 主存块号%分组数



## 替换算法

- 随机算法
- 先进先出
- 近期最少使用 LRU
  - 计数器：不断++；命中则清零，比其低的+1；计数器**最大**的淘汰
  - 基于局部性原理，cache命中率高

- 最不经常用算法
  - 命中则计数器+1；最小的淘汰
  - 记录的是全局，命中率低

## 写策略

- 写命中
  - 写回法；脏位：是否被修改
  - 全写法；把改的那一小块放入写缓冲（SRAM）

- 写不命中
  - 写分配法：把写的调入cache，搭配写回法
  - 非写分配：不调入，直接写在磁盘，搭配全写法
- 多级cache：
  - 各级cache采取 全写法+非写分配
  - cache和主存采用 写回+写分配

# 3.6

## 页式存储器

- 逻辑地址 虚地址
- 物理地址 实地址

![image-20230918232158248](http://123.249.77.122/wp-content/uploads/2023/09/60afd01d301b734b642b03475ded26f.png)

- 快表存的是页表项副本，cache存的是主存块数据的副本
- 主存 - 辅存，cache - 主存，快表 - 页表，有差不多的对应关系



# 4.1

## 指令

- 一二三四地址指令
- 定长/变长指令字
- 定长操作码/可变长操作码



## 扩展操作码

![image-20230919125308835](http://123.249.77.122/wp-content/uploads/2023/09/e36be1aeb5ee813b31be87565b10c20-1.png)

![image-20230919125815891](http://123.249.77.122/wp-content/uploads/2023/09/fdccd7c25652c94b1a426eb14dccc0b.png)

# 4.2

## 指令寻址

**PC 程序计数器**：指向下一条指令的地址

- 顺序
  - 按字编址：PC+1
  - 按字节：+2
  - 变长：先读入第一个字，根据操作码判断该指令字节数n，PC+n
- 跳跃
  - 正常+1，遇到JMP强行更变为指定指令



## 数据寻址（重要）

- 每一个地址前面都增加寻址方式位
- 真实地址EA
- 十种寻址方式
  - \# 标志立即数 立即寻址（区分直接寻址）
  - 偏移寻址：基址寻址，相对寻址，变址寻址

### 偏移寻址

**基址寻址**

- 设基址寄存器BR，记录基地址，EA =（BR）+ A；A作为偏移量
- 也可在指令中设R0，指定通用寄存器的位置
- BR面相操作系统，不由程序员改变
- 优：可以存更多数据；便于浮动（整段程序在内存的浮动）
- **多道程序并发**

**变址寻址**

- 变址寄存器IX（index register），作为偏移量；A作为基地址
- 也可通用寄存器
- 面向用户
- **循环程序**

**相对寻址**

- A是相对PC所指位置的偏移量
- 便于程序浮动（一段代码在内存），多用于**转移指令**

### 堆栈寻址



# 4.3

## intel

- 指令：操作码（干嘛）+ 地址码（数据在哪）

  ![image-20230921144325176](http://123.249.77.122/wp-content/uploads/2023/09/0f450c56f2ffcb6189d96365a71823e.png)

- 寄存器

  - EBP 指向当前栈的“底部”
  - ESP 指向当前栈的“顶部”

  ![image-20230921144508513](http://123.249.77.122/wp-content/uploads/2023/09/abfcb56fd531e089164e1947c5d2896.png)

- 常见指令介绍

  - 除法：s 指的是除数，被除数会被提前放到寄存器中

  ![image-20230921145539333](http://123.249.77.122/wp-content/uploads/2023/09/74fb8fb6a82dcac93818e353466bb7a.png)

![](http://123.249.77.122/wp-content/uploads/2023/09/ecf6c205f7f4bb194c2959901d6d19f.png)

- <\reg> 寄存器；<\mem> 内存；<\con>常数；x86中不允许两个操作数都来自主存

## AT&T

![image-20230921150620683](http://123.249.77.122/wp-content/uploads/2023/09/8067d83c5c819b67a3e3c60ae0bd2d0.png)

## 选择语句

- PC（Program Counter） 程序计数器 也称IP（Instruction Pointer）

- jmp <\地址> 无条件转移指令，地址可以来自寄存器、主存、常数

  - Jxxx 条件转移指令（记英文），一般前面会加一个cmp比较（进行a-b运算并存标志位），底层原理是判断标志位

  ![image-20230921151729237](http://123.249.77.122/wp-content/uploads/2023/09/27634aa68f63c4244df685b659e2879.png)

- loop实现循环 必须是ecx--！不能是其他寄存器

  - loopnz 多加一个ZF==0的判断

  ![image-20230921153142380](http://123.249.77.122/wp-content/uploads/2023/09/21998e3c6c7b00520d90e65834fab72.png)



## 函数调用

![image-20230921153728825](http://123.249.77.122/wp-content/uploads/2023/09/4eaf4316377bbb4e3a2b59706858c3e.png)

![image-20230921154741459](http://123.249.77.122/wp-content/uploads/2023/09/481d7fa1ab75b7489255db35f37639b.png)

- 用push和pop访问只能访问栈顶指的数 - > 用mov指令结合esp ebp访问栈帧数据

### 切换栈帧

- push ebp 然后 mov ebp, esp，这两条等价于enter
- 每一个函数底部都存储了上一层函数的基地址
- mov esp,ebp 然后 pop ebp，这两条等价于leave

### 传递参数和返回值

- 局部变量集中存储在栈帧底部，越前越顶
- 参数在栈顶，越前越顶
- 返回值一般写在eax寄存器中，传入的参数在栈中

![image-20230921163248063](http://123.249.77.122/wp-content/uploads/2023/09/203f4f4b808083f98c0f3d8168faad1.png)

# 4.4

## CISC和RISC

![image-20230921163845781](http://123.249.77.122/wp-content/uploads/2023/09/cf4a9b25442e6c44cd622de1c0ba923.png)



# 5.1

## CPU

- 运算器：数据加工
- 控制器：取指令，分析指令（操作码译码），执行指令，中断处理

## 运算器

- 算术逻辑单元

- 通用寄存器组，暂存寄存器

- 程序状态字寄存器

- 移位器

- 计数器

- 哪个通用寄存器连ALU？

  - 多路选择器

    ![image-20230925172153966](http://123.249.77.122/wp-content/uploads/2023/09/e1a376b99cb3f1890f714f49374ff18.png)

  - 三态门：性能高，硬件复杂

    ![image-20230925172321380](http://123.249.77.122/wp-content/uploads/2023/09/8f13f3a5981d381e28a9b41489bcc30.png)

  - CPU内部单总线（让寄存器连到总线上）：简单，但数据传输存在较多冲突，性能低

    ![](http://123.249.77.122/wp-content/uploads/2023/09/0870c62a3289db89433423caf251d5d.png)

  

## 控制器

- 程序计数器 PC Program Counter
- 指令寄存器 IR Instruction Register：地址码+操作码
- 指令译码器 ID Instruction Decoder
- 微操作信号发生器
- 时序系统
- 存储器地址寄存器 MAR
- 注意哪些寄存器对用户可见（橙色）哪些不可见（灰色）！

![image-20230925174323720](http://123.249.77.122/wp-content/uploads/2023/09/dc75cc6100500378aff1421890060ad.png)



# 5.2

## 指令周期

- **指令周期**：CPU从主存中每取出并执行一条指令所需的全部时间。
- **指令周期**常常用若干**机器周期**来表示，机器周期又叫**CPU周期**。
- 一个**机器周期**又包含若干**时钟周期**（也称为节拍、T周期或CPU时钟周期,它是CPU操作的最基本单位），每个机器周期的节拍数可以不一样。

![](http://123.249.77.122/wp-content/uploads/2023/09/241d470124145e4012bed4d8032d74a.png)

### 指令周期流程

- 取指FE、间址IND、执行EX、中断周期INT，通过触发器判断哪一个阶段，都可能访存

- 取值周期

  ![image-20230925200705822](http://123.249.77.122/wp-content/uploads/2023/09/7441e8c1cfb1c6aa632dbf0b9219b86.png)

- 间址周期

  ![image-20230925201148963](http://123.249.77.122/wp-content/uploads/2023/09/ec183edc5da67a709318621751866be.png)

- 中断周期：用堆栈保存断点

  ![](http://123.249.77.122/wp-content/uploads/2023/09/1eb94079c11b38ec3801ce103a74375.png)

## 指令执行方案

- 单指令周期
- 多指令周期
- 流水线方案：尽量让更多的指令同时运行



# 5.3

## 数据通路

- 控制信号：控制部件产生的，输入/流出
- 数据通路基本结构：单总线/多总线/专用数据通路

## 单总线方式

- 寄存器间：(PC) -> Bus -> MAR

- 主存与CPU：(PC) -> Bus -> MAR ; 1->R（CU通过控制总线对主存发出读信号）; MEM(MER) - > MDRinE有效

- 注：MDRinE指（外部总线）主存输入MDR，MDRin指MDR输入CPU内部总线

- 例题分析

  - 取址周期

    ![image-20230926123258038](http://123.249.77.122/wp-content/uploads/2023/09/aa3b93dfdbdc7fe40ba65374029fbc9.png)

  -  间址周期

    ![image-20230926141429971](http://123.249.77.122/wp-content/uploads/2023/09/1b99d750ae015945dfed1d2cb5ff978.png)

  -  执行周期

    ![image-20230926141751052](http://123.249.77.122/wp-content/uploads/2023/09/45665b0cfb5f1961e5bfedd6144b6b9.png)

    

## 专用数据通路

- 考查形式

  ![](http://123.249.77.122/wp-content/uploads/2023/09/6354a7b15b77297d913f576c1d6d30c.png)

成功测除非v地v个人不好意思的具体不出现内部如一日哇真的//贺思为留念

- 补充解释
  - 把指令操作码部分放入微操作信号发生器，里面有译码器

# 5.4

## 硬布线控制器

### 回顾

- 微命令、微操作
- 一个节拍内可以**并行**完成多个“**相容的**”微操作

![](http://123.249.77.122/wp-content/uploads/2023/09/127dbda1087307a4ef1d9a5e78cf0f2.png)





















# 6.1 

## 总线概述

- 总线是一组能为多个部件**分时共享**的公共信息传送线路
- 每个总线可能包含很多个信号线
- 同一时刻只能一个部件发数据（否则可能冲突），可以多个读

![image-20230915162332960](http://123.249.77.122/wp-content/uploads/2023/09/ad8527159d48e524af7df43499e51ff.png)

- 特性：机械特性，电气特性，功能特性，时间特性

### 分类

#### 按传输格式

- 串行总线：USB
  - 一次传1bit，一条传输线，成本低，抗干扰强，长距离传输；
  - 拆卸，装配；串行并行转换；
- 并行总线：数据总线
  - 逻辑时序简单；
  - 传输成本高，干扰问题（不一定比串行快）；

#### 按功能

- **片内总线**：**芯片内部**的总线。它是CPU芯片内部寄存器与寄存器之间、寄存器与ALU之间的公共连接线。
- **系统总线**：系统总线是计算机系统内**各功能部件**(CPU、主存、IO接口)之间相互连接的总线。
  - 数据总线：传输各功能部件之间的数据信息,它是**双向**传输总线,其位数与机器字长、存储字长有关。
  - 地址总线：指出数据总线上的源数据或目的数据所在的主存单元或1/0端口的地址，它是单向传输总线,地址总线的位数与主存地址空间的大小有关。
  - 控制总线传输的是控制信息,包括CPU送出的控制命令和主存(或外设)返回CPU的反馈信号。

- **通信总线**：不同设备间

### 系统总线

- 单总线结构

  ![image-20230915172919579](http://123.249.77.122/wp-content/uploads/2023/09/d67aef99e77844a3b68b58713b7706c.png)

- 双总线结构

  ![image-20230915173052898](http://123.249.77.122/wp-content/uploads/2023/09/5c6c6bfda3bcddfef9b0e1fce4247ad.png)

- 三总线结构

  ![image-20230915173052898](http://123.249.77.122/wp-content/uploads/2023/09/b4ce2e14001bf42cb121875c195d792.png)

- 四总线（现代）

  - 桥接器：数据缓冲、转换、控制
  - 越靠近CPU速度越快



## 补充：机器字长、存储字长等

### 存储单元

- 存放一个机器字的所有存储元的集合
- 存储元：存放一个二进制位的基本器件（或电路）
- CPU访问存储器的**基本单位**
- 长度取决于编址方式

### 存储字长

- 一个存储单元中二进制代码的位数
- 通常和MDR位数相同
- 不一定与机器字长相同（一般小于等于机器字长）
- 不固定

### 机器字长

- CPU 一次能处理的二进制数据的最大位数。通常与CPU内**寄存器**的位数有关。eg. windows 64位/32位，这里的64位和32位指的就是该操作系统的机器字长。
- CPU总线的宽度=运算器的位数=通用寄存器的宽度=数据总线宽度

### 指令字长

- 指令字长指的是一个机器指令中包含的二进制代码的位数

### 按字编址

- 1字（word） = 2字节（16位） 或 4字节（32位） 或 8字节（64位）

- 存储字长 = 1B = 8bit



### 按字/字节编址

- 1字节（Byte） = 8 位（bit）
- 存储字长 = 机器字长



## 性能指标

- **传输周期**（总线周期）

  - 一次总线操作所需的时间
  - (包括申请阶段、寻址阶段、传输阶段和结束阶段)。

- **时钟周期**（机器的时钟周期）：

  - 计算机有一个统一的时钟,以控制整个计算机的各个部件。

  - 可能由桥接器提供

- **工作频率**

  - 1/总线周期。

  - 若总线周期=N个时钟周期,则总线的工作频率=时钟频率/N。
  - 指一秒内传送几次数据

- **时钟频率**
  - 1/时钟周期
  - 指一秒内有多少个时钟周期。
- 总线**宽度**
  - 同时能够传输的**数据位数**
  - 通常指**数据总线的根数**
- 总线**带宽**
  - 数据传输率，**单位时间总线上可传输数据的位数**
  - = 总线工作频率*总线宽度
  - 有效数据传输率
- 总线复用
- 信号线数：三种总线数的和



## 总线仲裁

- （硬件的调度问题）
- 主设备：获得总线控制权
- 从设备

### 集中仲裁

- **总线控制器** 判优

- 链式查询 控制总线中的BS总线忙 BR总线请求 BG总线允许
  - 离控制器越近优先级越高
- 计数器查询：增加设备地址的一组线，少了一根BG
  - 对电路故障没有链式敏感
  - 可改变优先次序
- 独立请求方式：每个设备都有独立的BG和BR连控制部件，排队器
  - 响应速度快，优先次序灵活
  - 控制线数量多，逻辑复杂

### 分布式仲裁

- 仲裁号



## 操作和定时

- 申请分配：传输请求+总线仲裁
- 寻址阶段：获得地址和命令，启动从模块
- 传输阶段：主模块和从模块数据交换
- 结束阶段：主模块的有关信息从系统总线上撤除

### 同步通信

- 统一时钟
- 优点
  - 传送速度快，具有较高的传输速率；
  - 总线控制逻辑简单。
- 缺点
  - 主必设备属于强制性同步;
  - 不能及时进行数据通信的有效性检验,可靠性较差。
- 同步通信适用于**总线长度较短**及总线**所接部件的存取时间比较接近**的系统。

![image-20230915205623865](http://123.249.77.122/wp-content/uploads/2023/09/2ad501285fce6688fdcb9184b9466ee.png)



### 异步通信

- 应答方式，**周期可变**
- 定时方式
  - 不互锁：请求和回答的撤销不会受到对方的制约
  - 半互锁：请求的撤销受到回答的制约；回答的撤销不会受到请求的制约
  - 全互锁：都制约，但速度最慢

- 优点：总线周期长度可变，能保证两个**工作速度相差很大**的部件或设备之间可靠地进行信息交换，自动适应时间的配合。
- 缺点：比同步控制方式稍复杂一些，速度比同步定时方式慢。

### 半同步通信

- 在统一时钟的基础上，加一个等待响应信号 WAIT

### 分离式通信

- 在从模块准备数据的时候把总线的使用前让给别人
- 采取同步方式通信



## 总线标准（408不考）

### 系统总线

- **ISA**、**EISA** 并行总线

- FBS、QPI

### 局部总线

- VESA 和北桥芯片相连、并行总线
- **PCI** 不依附某个具体的处理器，支持突发传达
- APG 并行
- **PCI - E** 串行 点对点 可全双工

### 设备总线

- RS-232C 串行 通信总线
- SCSI 并行 满足高速IO设备
- PCMCIA 便携设备接口
- **USB** 串行 差模信号

- IDE（ATA） 并行 硬盘光驱接口
- SATA 串行



## 并行总线和串行总线

### 并行总线

- 用**m**根线每次传送**m**个比特，用**高/低电平**表未1/0，通常采用**同步定时**方式，由于线间信号**干扰**，因此总线工作频率不能太高。另外，各条线不能有长度差，长距离并行传输时工艺难度大。

### 串行总线

- 用两根线每次传送**一个比特**，采用“**差模型号**”表示1/0，通常采用**异步定时**方式，工作频率可以很高。现在的串行总线通常基于包传输，如80bit为一个数据包，包与包之间有先后关系，因此

- 可以用多个数据通路分别串行传输多个数据包。因此某种程度上现在的串行总线也有“并行”的特点

### 计算

- 波特率：每秒传输的二进制位数，bps

  ![image-20230920173931211](http://123.249.77.122/wp-content/uploads/2023/09/ebdf88910c8993e672c40d81bd89fc3.png)

- 比特率：单位时间内传送二进制有效数据的位数；

  - 比特率 = 波特率*单个调制状态对应的二进制位数

  ![image-20230920173947073](http://123.249.77.122/wp-content/uploads/2023/09/ec4c3f11da0ec3759671aa190ebcb78.png)





# 7.1 

- IO接口（IO控制器）：一块集成在主板上的芯片，连接主机与设备

## IO控制方式

- 轮询；中断；

  - 每次读写一个字

- DMA

  - 一整块数据结束之后，才需要cpu介入

  ![](http://123.249.77.122/wp-content/uploads/2023/10/952b26c9666333cd5531de43650056d.png)

- 通道控制方式：（就是相当于把CPU对IO设备的控制功能提到通道上）

  - 通道程序提前编制好放到主存中
  - cpu告诉通道执行内存哪个地方的指令 和 哪个IO设备，然后通道再去一条条执行
  - 这一系列指令执行结束后，才需要cpu介入

  ![image-20231010143004498](C:\Users\31067\AppData\Roaming\Typora\typora-user-images\image-20231010143004498.png)

## IO软件

- IO指令由操作码 命令码 设备码组成
- cpu指令：由操作码+地址码组成
- IO指令与普通指令格式略有不同，操作码指明了CPU要对IO接口做什么，命令码指明了l/O接口要对设备做什么



## 外部设备

### 显示器

- 分辨率：所能表示的像素个数

- 灰度级：n 位可以表示 2^n 种不同的亮度或颜色

- 帧频：通常大于30Hz时才不会看到闪烁，一般为60到120

- 显示存储器（刷新存储器） VRAM

  - 一帧图像信息存储在刷新存储器中
  - VRAM容量 = 分辨率 * 灰度级位数
  - VRAM带宽 = 分辨率 * 灰度级位数 * 帧频

  ![image-20231010152020500](http://123.249.77.122/wp-content/uploads/2023/10/0c92e5a22c43b5db2f6357d3e276244.png)

### 阴极射线管（CRT）

![](http://123.249.77.122/wp-content/uploads/2023/10/1dd8900850c20f1cbc0d06d59b57704.png)



## IO接口

- 作用：实现主机和io设备的通信
  - 数据缓冲
  - 错误或状态监测
  - 控制和定时
  - 数据格式转换：串并行转换

- 工作原理

  ![image-20231010215833705](http://123.249.77.122/wp-content/uploads/2023/10/8452c0542ab139e20e926a9a4cf8d85.png)

### 端口Port编址

- （和内存）统一编址
  - 优点:
    使用专用/o指令，程序编制清晰/o端口地址位数少，地址译码速度快I/o端口的地址不占用主存地址空间
  - 缺点：io指令类型少，一般只能对端口进行传送操作。程序设计灵活性差；需要cpu提供存储器读/写、Io设备读/写两组控制信号，增加了控制逻辑电路的复杂性
- 独立编制：需要设置单独的IO指令访问IO端口
  - 优点：不需要专门的输入/输出指令，所有访存指令都可直接访问端口，程序设计灵活性高；端口有较大的编址空间；读写控制逻辑电路简单
  - 缺点：端口占用了主存地址空间，使主存地址空间变小外设寻址时间长(地址位数多，地址译码速度慢)



## 程序查询方式

![](http://123.249.77.122/wp-content/uploads/2023/10/7b727767c58c35d489566ba0af743eb.png)





















